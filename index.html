<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thu·∫ø TNCN 3D Glassmorphism - Cam NƒÉng ƒê·ªông</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        :root { 
            --primary-orange: #ff7e5f; 
            --deep-orange: #feb47b; 
            --accent-dark: #d35400;
            --glass-bg: rgba(255, 255, 255, 0.85);
            --shadow-3d: 0 20px 50px rgba(0, 0, 0, 0.2);
        }

        body { 
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; 
            /* N·ªÅn m√†u cam hi·ªáu ·ª©ng Gradient 3D */
            background: linear-gradient(135deg, #ff9966 0%, #ff5e62 100%);
            background-attachment: fixed;
            display: flex; 
            justify-content: center; 
            padding: 20px; 
            color: #333; 
            min-height: 100vh;
            position: relative; 
            top: 0 !important; 
        }
        
        /* Hi·ªáu ·ª©ng Glassmorphism cho khung ch√≠nh */
        .container { 
            background: var(--glass-bg);
            backdrop-filter: blur(15px); /* L√†m m·ªù n·ªÅn ph√≠a sau */
            -webkit-backdrop-filter: blur(15px);
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: var(--shadow-3d);
            border: 1px solid rgba(255, 255, 255, 0.3);
            width: 100%; 
            max-width: 650px; 
            transition: transform 0.3s ease;
        }

        /* Menu Ng√¥n ng·ªØ x·ªï xu·ªëng */
        .header-tools { display: flex; justify-content: flex-end; align-items: center; margin-bottom: 20px; gap: 10px; }
        .custom-lang-select {
            padding: 8px 12px; border-radius: 10px; border: 1px solid rgba(0,0,0,0.1);
            background: rgba(255,255,255,0.9); font-size: 13px; cursor: pointer; outline: none;
        }

        .logo-wrapper { text-align: center; margin-bottom: 20px; border-bottom: 1px solid rgba(0,0,0,0.05); padding-bottom: 15px; }
        .logo-wrapper img { max-height: 60px; filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.1)); }
        
        .tab-group { margin-bottom: 15px; }
        .tab-label { font-size: 11px; font-weight: bold; color: #e67e22; text-transform: uppercase; margin-bottom: 6px; display: block; letter-spacing: 1px; }
        .tab-container { display: flex; background: rgba(0,0,0,0.05); border-radius: 12px; padding: 5px; gap: 5px; }
        
        .tab { 
            flex: 1; text-align: center; padding: 12px 5px; cursor: pointer; border-radius: 10px; 
            font-weight: bold; font-size: 13px; transition: 0.3s; color: #7f8c8d; 
        }
        .tab.active { 
            background: white; color: #d35400; 
            box-shadow: 0 4px 15px rgba(211, 84, 0, 0.2); 
        }
        
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; color: #444; }
        input, select { 
            width: 100%; padding: 12px; border: 1px solid rgba(0,0,0,0.1); border-radius: 10px; 
            background: rgba(255,255,255,0.9); font-size: 16px; outline: none; transition: 0.2s;
        }
        input:focus { border-color: #ff7e5f; box-shadow: 0 0 0 3px rgba(255, 126, 95, 0.2); }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        /* N√∫t t√≠nh to√°n 3D */
        button.btn-calc { 
            width: 100%; padding: 18px; 
            background: linear-gradient(to right, #ff416c, #ff4b2b); 
            color: white; border: none; border-radius: 12px; cursor: pointer; 
            font-size: 18px; font-weight: bold; margin-top: 15px; 
            box-shadow: 0 8px 20px rgba(255, 75, 43, 0.3);
            transition: 0.3s;
        }
        button.btn-calc:hover { transform: translateY(-2px); box-shadow: 0 12px 25px rgba(255, 75, 43, 0.4); }
        
        /* Phi·∫øu k·∫øt qu·∫£ */
        #print-section { 
            display: block; visibility: hidden; height: 0; overflow: hidden;
            padding: 40px; background: #fff; border-radius: 15px;
        }
        #print-section.visible { visibility: visible; height: auto; border: 1px solid #eee; margin-top: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        
        .row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f1f1f1; }
        .row.total { 
            font-weight: bold; font-size: 1.6rem; border-top: 3px solid #ff7e5f; 
            margin-top: 15px; border-bottom: none; color: #ff4b2b;
        }
        
        #btn-group { margin-top: 20px; display: none; grid-template-columns: 1fr 1fr; gap: 15px; }
        .btn-download { 
            background: #2c3e50; color: white; padding: 14px; border: none; 
            border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.3s;
        }
        .btn-download:hover { background: #1a252f; }

        /* ·∫®n widget g·ªëc */
        #google_translate_element { display: none !important; }
        .goog-te-banner-frame { display: none !important; }
        body { top: 0px !important; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-tools">
        <span style="font-size: 13px; font-weight: bold; color: #d35400;">üåç Ng√¥n ng·ªØ:</span>
        <select class="custom-lang-select" onchange="changeLanguage(this.value)">
            <option value="vi">Ti·∫øng Vi·ªát</option>
            <option value="en">English</option>
            <option value="zh-CN">ÁÆÄ‰Ωì‰∏≠Êñá</option>
            <option value="ko">ÌïúÍµ≠Ïñ¥</option>
            <option value="ja">Êó•Êú¨Ë™û</option>
        </select>
    </div>

    <div id="google_translate_element"></div>

    <div class="logo-wrapper">
        <img src="logo.png" alt="Logo" onerror="this.style.display='none'">
        <h2 class="notranslate" style="color: #ff4b2b; letter-spacing: -1px;">TAX CALCULATOR PRO</h2>
    </div>

    <div class="tab-group">
        <span class="tab-label">NƒÉm 2026 (Lu·∫≠t m·ªõi)</span>
        <div class="tab-container">
            <div id="tab-gross-2026" class="tab active" onclick="setMode('GROSS', 2026)">Gross ‚Üí Net</div>
            <div id="tab-net-2026" class="tab" onclick="setMode('NET', 2026)">Net ‚Üí Gross</div>
        </div>
    </div>

    <div class="tab-group">
        <span class="tab-label">Tr∆∞·ªõc nƒÉm 2025 (Lu·∫≠t c≈©)</span>
        <div class="tab-container">
            <div id="tab-gross-2025" class="tab" onclick="setMode('GROSS', 2025)">Gross ‚Üí Net</div>
            <div id="tab-net-2025" class="tab" onclick="setMode('NET', 2025)">Net ‚Üí Gross</div>
        </div>
    </div>

    <div class="form-group">
        <label id="income-label">Thu nh·∫≠p Gross h√†ng th√°ng (2026):</label>
        <input type="text" id="income-input" oninput="formatCurrency(this)" placeholder="0">
    </div>

    <div class="grid">
        <div class="form-group">
            <label>Ng∆∞·ªùi ph·ª• thu·ªôc:</label>
            <input type="number" id="dependents" value="0">
        </div>
        <div class="form-group">
            <label>Mi·ªÖn thu·∫ø:</label>
            <input type="text" id="nonTaxable" oninput="formatCurrency(this)" value="730,000">
        </div>
    </div>

    <div class="form-group">
        <label>L∆∞∆°ng ƒë√≥ng B·∫£o hi·ªÉm:</label>
        <select id="insType" onchange="toggleIns()">
            <option value="full">ƒê√≥ng tr√™n 100% l∆∞∆°ng</option>
            <option value="custom">M·ª©c ƒë√≥ng c·ªë ƒë·ªãnh</option>
        </select>
        <input type="text" id="insCustom" style="display:none; margin-top:10px;" oninput="formatCurrency(this)" placeholder="S·ªë ti·ªÅn ƒë√≥ng BH...">
    </div>

    <button class="btn-calc" onclick="process()">PH√ÇN T√çCH THU NH·∫¨P</button>

    <div id="print-section">
        <div style="text-align:center; border-bottom: 3px solid #ff7e5f; margin-bottom: 20px; padding-bottom: 15px;">
            <h2 id="out-header" style="margin:0; color: #ff4b2b;">K·∫æT QU·∫¢ T√çNH TO√ÅN</h2>
            <p id="res-mode" style="font-weight:bold; color: #7f8c8d; margin: 5px;"></p>
        </div>
        <div class="row"><span>T·ªïng l∆∞∆°ng (Gross):</span> <span id="out-gross" style="font-weight:bold;"></span></div>
        <div class="row"><span>B·∫£o hi·ªÉm x√£ h·ªôi (10.5%):</span> <span id="out-bh"></span></div>
        <div class="row"><span>Gi·∫£m tr·ª´ b·∫£n th√¢n:</span> <span id="out-gt-bt"></span></div>
        <div class="row"><span>Gi·∫£m tr·ª´ gia c·∫£nh:</span> <span id="out-gt-pt"></span></div>
        <div class="row"><span>Thu nh·∫≠p t√≠nh thu·∫ø:</span> <span id="out-tntt"></span></div>
        <div class="row" style="color:#e74c3c; font-weight:bold;"><span>Thu·∫ø TNCN n·ªôp NSNN:</span> <span id="out-tax"></span></div>
        <div class="row total"><span>TH·ª∞C NH·∫¨N (NET):</span> <span id="out-net"></span></div>
        
        <div id="compare-note" style="margin-top: 20px; padding: 15px; background: #fff5f2; border-radius: 12px; font-size: 14px; border: 1px solid #ffdcd3;"></div>
    </div>

    <div id="btn-group">
        <button class="btn-download" onclick="exportPDF('a4')">T·∫£i PDF A4</button>
        <button class="btn-download" onclick="exportPDF('a5')">T·∫£i PDF A5</button>
    </div>
</div>

<script>
    let currentMode = 'GROSS';
    let currentYear = 2026;

    function setMode(m, y) {
        currentMode = m; currentYear = y;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(`tab-${m.toLowerCase()}-${y}`).classList.add('active');
        document.getElementById('income-label').innerText = `Thu nh·∫≠p ${m === 'GROSS' ? 'Gross' : 'Net'} h√†ng th√°ng (${y}):`;
    }

    function googleTranslateElementInit() { new google.translate.TranslateElement({pageLanguage: 'vi'}, 'google_translate_element'); }
    function changeLanguage(langCode) {
        const select = document.querySelector('select.goog-te-combo');
        if (select) { select.value = langCode; select.dispatchEvent(new Event('change')); }
    }

    function formatCurrency(i) {
        let v = i.value.replace(/\D/g, "");
        i.value = v ? Number(v).toLocaleString('en-US') : "";
    }
    function parseV(id) { return parseFloat(document.getElementById(id).value.replace(/,/g, "")) || 0; }
    function toggleIns() { document.getElementById('insCustom').style.display = document.getElementById('insType').value === 'custom' ? 'block' : 'none'; }

    function calcTax(gross, nonTax, deps, iType, iCustom, year) {
        let bh = (iType === 'full' ? gross : iCustom) * 0.105;
        let selfGT = (year === 2026) ? 15500000 : 11000000;
        let depGT = (year === 2026) ? 6200000 : 4400000;
        let tntt = Math.max(0, gross - nonTax - bh - (selfGT + deps * depGT));
        let tax = 0, ti = tntt / 1000000;

        if (year === 2026) {
            if (ti > 100) tax = (ti - 100) * 0.35 + 20.5;
            else if (ti > 60) tax = (ti - 60) * 0.3 + 8.5;
            else if (ti > 30) tax = (ti - 30) * 0.2 + 2.5;
            else if (ti > 10) tax = (ti - 10) * 0.1 + 0.5;
            else tax = ti * 0.05;
        } else {
            if (ti > 80) tax = (ti - 80) * 0.35 + 18.15;
            else if (ti > 52) tax = (ti - 52) * 0.3 + 9.75;
            else if (ti > 32) tax = (ti - 32) * 0.25 + 4.75;
            else if (ti > 18) tax = (ti - 18) * 0.2 + 1.95;
            else if (ti > 10) tax = (ti - 10) * 0.15 + 0.75;
            else if (ti > 5) tax = (ti - 5) * 0.1 + 0.25;
            else tax = ti * 0.05;
        }
        return { bh, selfGT, depGT: deps*depGT, tntt, tax: Math.round(tax * 1000000), net: gross - bh - Math.round(tax * 1000000) };
    }

    function process() {
        let input = parseV('income-input'), nonTax = parseV('nonTaxable'), deps = parseInt(document.getElementById('dependents').value) || 0;
        let iType = document.getElementById('insType').value, iCustom = parseV('insCustom');
        
        let fGross = input;
        if (currentMode === 'NET') {
            let l = input, h = input * 3;
            for(let i=0; i<50; i++) {
                fGross = (l + h) / 2;
                if (calcTax(fGross, nonTax, deps, iType, iCustom, currentYear).net < input) l = fGross; else h = fGross;
            }
        }

        let res = calcTax(fGross, nonTax, deps, iType, iCustom, currentYear);
        const fmt = n => Math.round(n).toLocaleString('en-US') + ' ƒë';
        
        document.getElementById('out-gross').innerText = fmt(fGross);
        document.getElementById('out-bh').innerText = fmt(res.bh);
        document.getElementById('out-gt-bt').innerText = fmt(res.selfGT);
        document.getElementById('out-gt-pt').innerText = fmt(res.depGT);
        document.getElementById('out-tntt').innerText = fmt(res.tntt);
        document.getElementById('out-tax').innerText = fmt(res.tax);
        document.getElementById('out-net').innerText = fmt(res.net);
        document.getElementById('res-mode').innerText = `${currentMode} ‚Üí NET (${currentYear})`;
        
        let otherY = (currentYear === 2026) ? 2025 : 2026;
        let comp = calcTax(fGross, nonTax, deps, iType, iCustom, otherY);
        let diff = Math.abs(res.tax - comp.tax);
        document.getElementById('compare-note').innerHTML = `üß° <b>So s√°nh nhanh:</b> NƒÉm ${otherY} b·∫°n n·ªôp <b>${fmt(comp.tax)}</b> ti·ªÅn thu·∫ø. 
        ${currentYear === 2026 ? `Ti·∫øt ki·ªám ƒë∆∞·ª£c <b style="color:#d35400">${fmt(diff)}</b>.` : `ƒê√≥ng cao h∆°n <b style="color:#e74c3c">${fmt(diff)}</b> so v·ªõi lu·∫≠t m·ªõi.`}`;

        document.getElementById('print-section').className = 'visible';
        document.getElementById('btn-group').style.display = 'grid';
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    function exportPDF(size) {
        const element = document.getElementById('print-section');
        window.scrollTo(0,0);
        const opt = {
            margin: 0.5, filename: `Tax_Report_${currentYear}.pdf`,
            image: { type: 'jpeg', quality: 1 },
            html2canvas: { scale: 3, useCORS: true },
            jsPDF: { unit: 'in', format: size, orientation: 'portrait' }
        };
        setTimeout(() => { html2pdf().set(opt).from(element).save(); }, 500);
    }
</script>
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>
</html>
