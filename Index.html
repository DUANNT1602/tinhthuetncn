<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tính Thuế TNCN 2026 - Chuẩn Quy Định Mới - Thiết kế bởi Nguyễn Tiến Duẩn với sự hỗ trợ của Gemini</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root { --primary: #2c3e50; --secondary: #27ae60; --accent: #2980b9; }
        body { font-family: "Times New Roman", serif; background: #f4f7f6; display: flex; justify-content: center; padding: 20px; color: #333; }
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 650px; }
        .logo-wrapper { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 15px; }
        .logo-wrapper img { max-height: 70px; margin-bottom: 10px; }
        .tab-container { display: flex; margin-bottom: 20px; background: #eee; border-radius: 8px; padding: 5px; }
        .tab { flex: 1; text-align: center; padding: 12px; cursor: pointer; border-radius: 6px; font-weight: bold; transition: 0.3s; }
        .tab.active { background: white; color: var(--accent); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 12px; border: 1px solid #bdc3c7; border-radius: 6px; box-sizing: border-box; font-size: 16px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        button.btn-calc { width: 100%; padding: 15px; background: var(--secondary); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 18px; font-weight: bold; margin-top: 10px; }
        
        /* Giao diện Phiếu In */
        #print-section { display: none; margin-top: 30px; padding: 25px; border: 1px solid #333; background: #fff; position: relative; }
        .row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed #ccc; }
        .row.total { font-weight: bold; font-size: 1.2rem; border-top: 2px solid #333; margin-top: 10px; border-bottom: none; }
        .tax-table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 15px; }
        .tax-table th, .tax-table td { border: 1px solid #ddd; padding: 5px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <div class="logo-wrapper">
        <img src="logo.png" alt="Logo Công Ty" onerror="this.style.display='none'">
        <h2 style="margin:0">CÔNG CỤ TÍNH THUẾ TNCN 2026</h2>
        <p style="font-size: 14px; color: #666;">Cập nhật theo Luật Thuế TNCN mới nhất</p>
    </div>

    <div class="tab-container">
        <div id="tab-gross" class="tab active" onclick="switchMode('GROSS')">GROSS → NET</div>
        <div id="tab-net" class="tab" onclick="switchMode('NET')">NET → GROSS</div>
    </div>

    <div class="form-group">
        <label id="income-label">Thu nhập Gross hàng tháng:</label>
        <input type="text" id="income-input" oninput="formatCurrencyInput(this)" placeholder="Nhập số tiền...">
    </div>

    <div class="grid">
        <div class="form-group">
            <label>Người phụ thuộc:</label>
            <input type="number" id="dependents" value="0" min="0">
        </div>
        <div class="form-group">
            <label>Khoản miễn thuế:</label>
            <input type="text" id="nonTaxable" oninput="formatCurrencyInput(this)" value="730,000">
        </div>
    </div>

    <div class="form-group">
        <label>Đóng Bảo hiểm xã hội:</label>
        <select id="insType" onchange="toggleIns()">
            <option value="full">Đóng trên 100% lương</option>
            <option value="custom">Mức đóng cố định</option>
        </select>
        <input type="text" id="insCustom" style="display:none; margin-top:10px;" oninput="formatCurrencyInput(this)" placeholder="Nhập mức lương đóng BH...">
    </div>

    <button class="btn-calc" onclick="process()">TÍNH TOÁN CHI TIẾT</button>

    <div id="print-section">
        <div style="text-align:center;">
            <h3>PHIẾU DIỄN GIẢI THU NHẬP</h3>
            <p id="res-mode" style="font-weight:bold; color:var(--accent)"></p>
        </div>
        <div class="row"><span>Lương Gross:</span> <span id="out-gross"></span></div>
        <div class="row"><span>Bảo hiểm bắt buộc (10.5%):</span> <span id="out-bh"></span></div>
        <div class="row"><span>Giảm trừ gia cảnh:</span> <span id="out-gt"></span></div>
        <div class="row"><span>Thu nhập tính thuế:</span> <span id="out-tntt"></span></div>
        <div class="row" style="color:red"><span>Thuế TNCN:</span> <span id="out-tax"></span></div>
        <div class="row total"><span>THỰC NHẬN (NET):</span> <span id="out-net"></span></div>
        
        <details style="margin-top:15px; font-size: 12px;">
            <summary>Xem biểu thuế áp dụng (Bậc 5 mới)</summary>
            <table class="tax-table">
                <thead><tr><th>Bậc</th><th>Thu nhập tính thuế/tháng</th><th>Thuế suất</th></tr></thead>
                <tbody>
                    <tr><td>1</td><td>Đến 10trđ</td><td>5%</td></tr>
                    <tr><td>2</td><td>10trđ - 30trđ</td><td>10%</td></tr>
                    <tr><td>3</td><td>30trđ - 60trđ</td><td>20%</td></tr>
                    <tr><td>4</td><td>60trđ - 100trđ</td><td>30%</td></tr>
                    <tr><td>5</td><td>Trên 100trđ</td><td>35%</td></tr>
                </tbody>
            </table>
        </details>
    </div>

    <div id="btn-group" style="display:none; grid-template-columns: 1fr 1fr; gap:10px; margin-top:15px;">
        <button style="background:#34495e; padding:10px; color:white; border-radius:5px; border:none; cursor:pointer;" onclick="exportPDF('a4')">Tải PDF A4</button>
        <button style="background:#34495e; padding:10px; color:white; border-radius:5px; border:none; cursor:pointer;" onclick="exportPDF('a5')">Tải PDF A5</button>
    </div>
</div>

<script>
    let mode = 'GROSS';
    function switchMode(m) {
        mode = m;
        document.getElementById('tab-gross').className = m === 'GROSS' ? 'tab active' : 'tab';
        document.getElementById('tab-net').className = m === 'NET' ? 'tab active' : 'tab';
        document.getElementById('income-label').innerText = m === 'GROSS' ? 'Thu nhập Gross hàng tháng:' : 'Thu nhập Net mong muốn:';
    }
    function formatCurrencyInput(i) {
        let v = i.value.replace(/\D/g, "");
        i.value = v ? Number(v).toLocaleString('en-US') : "";
    }
    function parseV(id) { return parseFloat(document.getElementById(id).value.replace(/,/g, "")) || 0; }
    function toggleIns() { document.getElementById('insCustom').style.display = document.getElementById('insType').value === 'custom' ? 'block' : 'none'; }

    function calcTax(gross, nonTax, deps, iType, iCustom) {
        let bh = (iType === 'full' ? gross : iCustom) * 0.105;
        let gt = 15500000 + (deps * 6200000);
        let tntt = Math.max(0, gross - nonTax - bh - gt);
        let ti = tntt / 1000000, tax = 0;
        if (ti > 100) tax = (ti - 100) * 0.35 + 20.5;
        else if (ti > 60) tax = (ti - 60) * 0.3 + 8.5;
        else if (ti > 30) tax = (ti - 30) * 0.2 + 2.5;
        else if (ti > 10) tax = (ti - 10) * 0.1 + 0.5;
        else tax = ti * 0.05;
        tax = Math.round(tax * 1000000);
        return { bh, gt, tntt, tax, net: gross - bh - tax };
    }

    function process() {
        let input = parseV('income-input'), nonTax = parseV('nonTaxable'), deps = parseInt(document.getElementById('dependents').value) || 0;
        let iType = document.getElementById('insType').value, iCustom = parseV('insCustom');
        let fGross = input, res;
        if (mode === 'NET') {
            let l = input, h = input * 2;
            while (h - l > 1) {
                fGross = (l + h) / 2;
                if (calcTax(fGross, nonTax, deps, iType, iCustom).net < input) l = fGross; else h = fGross;
            }
            fGross = h;
        }
        res = calcTax(fGross, nonTax, deps, iType, iCustom);
        const fmt = n => Math.round(n).toLocaleString('en-US') + 'đ';
        document.getElementById('out-gross').innerText = fmt(fGross);
        document.getElementById('out-bh').innerText = fmt(res.bh);
        document.getElementById('out-gt').innerText = fmt(res.gt);
        document.getElementById('out-tntt').innerText = fmt(res.tntt);
        document.getElementById('out-tax').innerText = fmt(res.tax);
        document.getElementById('out-net').innerText = fmt(res.net);
        document.getElementById('res-mode').innerText = mode === 'GROSS' ? 'DIỄN GIẢI TỪ LƯƠNG GROSS' : 'DIỄN GIẢI TỪ LƯƠNG NET';
        document.getElementById('print-section').style.display = 'block';
        document.getElementById('btn-group').style.display = 'grid';
    }

    function exportPDF(s) {
        const e = document.getElementById('print-section');
        html2pdf().set({ margin: 0.5, filename: 'ThueTNCN-2026.pdf', jsPDF: { format: s } }).from(e).save();
    }
</script>
</body>
</html>